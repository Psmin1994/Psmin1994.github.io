---
title: sequelize 모듈 - 02
author: Psmin
data: 2023-05-25 13:41:57 +0900
categories: [Knowledge, Nodejs]
tags: [sequelize]
---

## Sequelize 관계 정의하기

> 참고 글 : [Sequelize - associate](https://sequelize.org/docs/v6/core-concepts/assocs/)

Sequelize에서는 **테이블 간의 관계 (1:1, 1:N, N:M)를 정의**할 수 있습니다.

모델에 속하는 <kbd>BeingTo</kbd>, <kbd>hasOne</kbd>, <kbd>hasMany</kbd>, <kbd>BelongsToMany</kbd> 함수 중 하나를 호출하고 다른 모델을 첫 번째 인수로 제공하여 사용합니다.

---

### 1:N 관계

1:N 관계에서는 **hasMany**와 **belongsTo** 메서드를 사용합니다.

![sequelize-one-to-many](/assets/img/sequelize-one-to-many.png){: .w-80}

User와 Comment를 정의해보겠습니다.

한 User가 많은 댓글을 가질 수 있으니 **User.hasMany를 사용**하고, Comment는 한 User에 속할 수 있으니 **Comment.belongsTo를 사용**합니다.

즉, 외래키가 존재하는 테이블이 **belogsTo를 사용**합니다.

```js
db.User.hasMany(db.Comment, { foreignKey: "commenter", sourceKey: "id" });

db.Comment.belongsTo(db.USer, { foreignKey: "commenter", targetKey: "id" });
```

또한, 두 번째 매개변수로 다양한 옵션을 전달할 수 있습니다.

- **Options**

  - <kbd>ForeignKey</kbd> : 외래 키를 직접 명시

    > foreignKey를 따로 지정하지 않는다면 모델명+기본 키로 이름이 자동 설정됩니다.

  - <kbd>sourceKey</kbd> : `hasMany`에서 사용하며 외래 키로 전할 속성을 명시

  - <kbd>targetKey</kbd> : `belongsTo`에서 사용하며 외래 키로 가져올 속성을 명시

  - <kbd>onDelete</kbd>, <kbd>onUpdate</kbd> : 엔티티의 상태 변화를 전파시키는 옵션,
    (RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL)

  - <kbd></kbd>

---

### 1:1 관계

1:1 관계에서는 **hasOne**와 **belongsTo**를 사용합니다.

![sequelize-one-to-one](/assets/img/sequelize-one-to-one.png){: .w-80}

```js
Foo.hasOne(Bar);
Bar.belongsTo(Foo);
```

---

### M:N 관계

M:N 관계에서는 **belongsToMany**를 사용합니다.

```js
// Post
db.Post.belongsToMany(db.Hashtag, { through: "PostHashtag" });

// Hashtag
db.Hashtag.belongsToMany(db.Post, { through: "PostHashtag" });
```

- **Options**

  - <kbd>through</kbd> : 생성될 중간 모델(연결 테이블)의 이름을 명시

---

## Sequelize로 CRUD
