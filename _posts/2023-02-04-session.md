---
title: express-session 모듈이란?
author: Psmin
data: 2023-02-04 16:11:42 +0900
categories: [Nodejs]
tags: [express-session]
---

# express-session 모듈에 대해 알아보자.

---

## 세션 (Session)

이전 포스팅에서 살펴본 쿠키(Cookie)는 클라이언트 측에 저장되기 때문에 보안이 취약한 단점이 있습니다.

세션은 저장하는 주체를 클라이언트가 아닌 서버로 옮겨 보안이 취약한 단점을 보안해줍니다.

<u>쿠키로 실제 데이터가 아닌 식별값</u>을 주고 <u>서버에서는 쿠키 값을 통해 실제 데이터를 식별하고 조회</u>해서 사용하도록 합니다.

서버에서 처리하는 만큼 **_서버의 부하가 커지지만 높은 보안성_**을 갖기 때문에 세션 방식이 더 많이 사용됩니다.

---

## express-session 모듈

express-session 모듈은 세션 기능들을 모듈화한 것으로 따로 설치하고 설정해주어야합니다.

특정 사용자를 위한 데이터를 임시적으로 저장하며 세션은 사용자별로 `req.session 객체` 안에 유지됩니다.

- **_설치_**
  ```console
  npm i express-session
  ```

---

### express-session 설정

모듈을 import하고 `session(Options)` 형태로 미들웨어로 등록합니다.

- **_Options_**

  - <kbd>resave</kbd>
    : 요청이 왔을 때 세션에 수정사항이 없어도 저장할지 여부

  - <kbd>saveUninitialized</kbd>  
    : 세션에 저장할 내역이 없어도 처음부터 세션을 생성할 지

  - <kbd>secret</kbd>  
    : 암호화할 때 사용할 키

  - <kbd>store</kbd>  
    : 세션 저장 장소, 기본값은 메모리

  - <kbd>cookie</kbd>  
    : 세션 관리 시 클라이언트에 보내는 쿠키, 쿠키 설정과 동일

  - <kbd>name</kbd>
    : 세션 쿠키명, 기본값은 'sid'

- **_예시_**

  ```js
  import express from "express";
  import session from "express-session";
  import cookieParser from "cookie-parser";

  const app = express();

  app.use(cookieParser(process.env.COOKIE_SECRET));

  app.use(
    session({
      secure: true,
      secret: process.env.COOKIE_SECRET,
      resave: false,
      saveUninitialized: false,
      name: "sessionId",
    })
  );

  // 3000 포트로 서버 오픈
  app.listen(3000, () => {
    console.log("express server on port 3000");
  });
  ```

---

## 세션 접근

세션 객체에 <kbd>req.session</kbd>으로 접근이 가능하다.

- **_예시_**

  ```js
  import express from "express";
  import session from "express-session";
  import cookieParser from "cookie-parser";

  const app = express();

  app.use(cookieParser(process.env.COOKIE_SECRET));

  app.use(
    session({
      secure: true,
      secret: process.env.COOKIE_SECRET,
      resave: false,
      saveUninitialized: false,
      name: "sessionId",
    })
  );

  app.get("/session", (req, res) => {
    console.log(req.session);
    if (req.session.num === undefined)
      // 세션이 없다면
      req.session.num = 1; // 세션 등록
    else req.session.num += 1;

    res.send(`${req.session.num}번 접속`);
  });

  // 3000 포트로 서버 오픈
  app.listen(3000, () => {
    console.log("express server on port 3000");
  });
  ```

- http://localhost:3000/session 로 접속했을 때  
  ![session-ex-01](/assets/img/session-ex-01.png){: .w-80 .normal .left}
  ![session-ex-02](/assets/img/session-ex-02.png){: .w-80 .normal}
