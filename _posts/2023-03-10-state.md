---
title: State
author: Psmin
data: 2023-03-10 21:31:13 +0900
categories: [Knowledge, ReactJS]
tags: [State]
---

## State 상태

State는 React 컴포넌트의 Data를 말하며, 개발자가 정의하는 것으로 렌더링이나 데이터 흐릅에 사용되는 값만을 State에 포함시켜야합니다.

또한, State는 특별한 값이 아닌 Javascript의 객체입니다.

---

## State 정의

- `Class Component의 생성자 함수`  
  모든 클래스 컴포넌트에는 생성자 함수(constructor)가 존재합니다.  
  생성자 함수는 클래스가 생성될 때 실행되는 함수입니다.

- `Class Component에서의 State`
  Class Component의 경우 State를 생성자에서 정의합니다.
  this.state 코드로 현재 컴포넌트의 State로 정의합니다.

```js
// Class Component
class LikeButton extends React.Component {
	constructor(props) {
    	super(props);

        this.state = { // state를 생성자에서 정의
        	liked: false
        };
    }
    ...
}
```

- `Function Component에서의 State`  
  Function Component의 경우 State를 useState Hook을 사용해서 정의합니다.

```js
// Function Component
import { useState } from "react";

function Example() {
  const [count, setCount] = useState(0); // useState Hook 사용
  return (
    <div>
      <p>버튼을 {count}번 눌렀습니다.</p>
      //
      <button onClick={() => setCount(count + 1)}>클릭</button>
    </div>
  );
}
```

---

## State 수정하기

State의 값을 변경하기 위해서는 반드시 setState 함수를 이용해야합니다.

State 값을 직접 변경하게 되면 React가 Component를 다시 렌더링 할 타이밍을 알아차리지 못합니다.

따라서, 반드시 `setState 함수`를 이용해 값을 변경해야합니다.  
setState 함수를 호출할 때 React에게 다시 렌더링 하라는 요청을 합니다.

```js
// Class Component
this.state = { name : 'Inje' };

this.setState( { name : 'Inje' } );

// Function Component
import { useState } from 'react';

function Example() {
    const [count, setCount] = useState(0);
    return (
        <div>
            <p>버튼을 {count}번 눌렀습니다.</p>
            <button onClick={() => {count = count + 1;}>클릭</button> // 이렇게 하면 안 된다.
        </div>
    );
}
```

---

## Object, Array를 갖는 State 수정하기

객체나 배열을 값으로 갖는 State를 수정할 때는 새로운 객체나 배열을 생성하고 변경합니다.

예시를 보겠습니다.

```js
// 잘못된 방법
const [user, setUser] = useState({ name: "민수", grade: 1 });

setUser((current) => {
  // user의 grade가 변경되었지만 user의 내용을 담는 object 자체가 변경된 것은 아니다.
  current.grade = 2;
  return current;
});

// 올바른 방법
const [user, setUser] = useState({ name: "민수", grade: 1 });

setUser((current) => {
  // 기존 user의 내용을 새로운 object에 담고 grade를 변경
  const newUser = { ...current };
  newUser.grade = 2;
  return newUser;
});
```

---

## React의 생명주기 LifeCycle

생명주기란 App이 실행되고 종료되는 과정을 특정 시점 별로 나눠둔 것을 말합니다.

React의 생명주기

- `Mounting 생성`  
  : Component가 실제 DOM에 삽입되는 것을 말합니다.

- `Updating 업데이트`  
  : Component가 변화하는 것을 말합니다.

- `Unmounting 삭제`  
   : Component가 DOM 상에서 제거되는 것을 말합니다.

![Component-lifeCycle](/assets/img/component-lifecycle.png){: .w-80}

- `constructor() 함수` : <kbd>State</kbd>를 초기화하는 메서드
- `render() 함수` : 클래스 컴포넌트에서 반드시 구현되어야 하는 렌더링 메서드
- `componentDidMount() 함수` : 컴포넌트가 마운트된 직후 호출되는 메서드
- `componentDidUpdate() 함수` : 컴포넌트가 업데이트된 직후 호출되는 메서드
- `componentWillUnmount() 함수` : 컴포넌트가 삭제되기 직전에 호출되는 메서드

componentDidMount, componentDidUpdate, componentWillUnmount는 생명주기에 따라 호출되는 클래스 컴포넌트 함수로서 생명주기 함수입니다.

즉, 컴포넌트는 생명 주기를 갖으며, 시간에 따라 생성되고 업데이트되며 결국 삭제됩니다.

---

### getDerivedStateFromProps

getDerivedStateFromProps 는 props 로 받아온 것을 state 에 넣어주고 싶을 때 사용합니다.

```js
static getDerivedStateFromProps(nextProps, prevState) {
  console.log("getDerivedStateFromProps");

  if (nextProps.color !== prevState.color) {
    return { color: nextProps.color };
  }

  return null;
}
```

---

### shouldComponentUpdate

shouldComponentUpdate 메서드는 컴포넌트가 리렌더링 할지 말지를 결정하는 메서드입니다.

```js
shouldComponentUpdate(nextProps, nextState) {
  console.log("shouldComponentUpdate", nextProps, nextState);
  // 숫자의 마지막 자리가 4면 리렌더링하지 않습니다
  return nextState.number % 10 !== 4;
}
```

---

### getSnapshotBeforeUpdate

getSnapshotBeforeUpdate 는 컴포넌트에 변화가 일어나기 직전의 DOM 상태를 가져와서 특정 값을 반환하면 그 다음 발생하게 되는 componentDidUpdate 함수에서 받아와서 사용을 할 수 있습니다.

```js
getSnapshotBeforeUpdate(prevProps, prevState) {
  console.log("getSnapshotBeforeUpdate");
  if (prevProps.color !== this.props.color) {
    return this.myRef.style.color;
  }
  return null;
}
```
